#+TITLE: org-roam-more - Org-Roam å¢å¼ºåŠŸèƒ½
#+AUTHOR: gongshangzheng
#+DATE: 2025-05-07
#+LANGUAGE: zh-CN

* æ¦‚è¿°

=org-roam-more= ä¸º [[https://www.orgroam.com/][org-roam]] æä¾›å¢å¼ºåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- ğŸ“ *Transclusion ç®¡ç†* - åµŒå…¥å¹¶åŒæ­¥å…¶ä»–èŠ‚ç‚¹çš„å†…å®¹
- ğŸ“¦ *èŠ‚ç‚¹å†…å®¹æ“ä½œ* - å¼ºå¤§çš„èŠ‚ç‚¹å†…å®¹è¯»å†™åŠŸèƒ½
- ğŸ”— *å¢å¼ºçš„èŠ‚ç‚¹åˆ›å»º* - æ™ºèƒ½èŠ‚ç‚¹æ’å…¥ä¸è‡ªåŠ¨é“¾æ¥
- ğŸ“… *æ—¥è®°é›†æˆ* - è‡ªåŠ¨è®°å½•åˆ°æ—¥è®°ç¬”è®°
- ğŸ› ï¸  *å®ç”¨å·¥å…·* - ä¸°å¯Œçš„ org-roam è¾…åŠ©å‡½æ•°é›†

* ç‰¹æ€§

** ğŸ”„ Transclusion ç³»ç»Ÿ

å°†ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å®¹æ’å…¥åˆ°å¦ä¸€ä¸ªä½ç½®ï¼ŒåŒæ—¶ä¿æŒåŒå‘åŒæ­¥ã€‚

- æ’å…¥ transclusion æ—¶ä¿ç•™åŸå§‹æ ‡é¢˜å±‚çº§
- æ¨é€/æ‹‰å–åŒæ­¥ï¼ˆåŒå‘ï¼‰
- å†…å®¹ä¸€è‡´æ€§æ£€æŸ¥
- ä½¿ç”¨ ediff çš„å¯è§†åŒ–å¯¹æ¯”
- åŸºäºæ ‡ç­¾çš„ transclusion è¿½è¸ª

** ğŸ“¦ èŠ‚ç‚¹å†…å®¹ç®¡ç†

- è·å–å’Œè®¾ç½®èŠ‚ç‚¹å†…å®¹ï¼Œå¯é€‰æ‹©ä¿ç•™/ç§»é™¤å±æ€§
- åŸºäºè·¯å¾„çš„å†…å®¹æ“ä½œï¼ˆä½¿ç”¨å¤§çº²è·¯å¾„ï¼‰
- åœ¨ç°æœ‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹
- ç¨‹åºåŒ–è®¾ç½®èŠ‚ç‚¹å±æ€§

** ğŸ”— æ™ºèƒ½èŠ‚ç‚¹åˆ›å»º

- åˆ›å»ºæˆ–é€‰æ‹©èŠ‚ç‚¹å¹¶è‡ªåŠ¨æ’å…¥é“¾æ¥
- æ”¯æŒæ™®é€šé“¾æ¥å’Œ transclusion
- åŸºäº hook çš„æ•è·å·¥ä½œæµ
- è¿‡æ»¤å™¨å’Œæ¨¡æ¿è‡ªå®šä¹‰

** ğŸ“… æ—¥è®°é›†æˆ

- è‡ªåŠ¨å°†æ–°èŠ‚ç‚¹æ’å…¥æ—¥è®°
- å¯é…ç½®çš„ hook ç³»ç»Ÿ
- æ‰‹åŠ¨æ’å…¥å½“å‰èŠ‚ç‚¹

* å®‰è£…

** ä½¿ç”¨ straight.el

#+BEGIN_SRC elisp
(straight-use-package
 '(org-roam-more :type git :host github :repo "gongshangzheng/org-roam-more"))
#+END_SRC

** ä½¿ç”¨ use-package

#+BEGIN_SRC elisp
(use-package org-roam-more
  :after org-roam
  :load-path "/path/to/org-roam-more/"
  :config
  (require 'org-roam-more))
#+END_SRC

* å¿«é€Ÿå¼€å§‹

** åŸºæœ¬ Transclusion å·¥ä½œæµ

#+BEGIN_SRC elisp
;; 1. æ’å…¥ transclusion
M-x org-roam-more-insert-transclude

;; 2. ç¼–è¾‘è½¬å†™çš„å†…å®¹...

;; 3. å°†æ›´æ”¹æ¨é€å›åŸèŠ‚ç‚¹
M-x org-roam-more-transclusion-push

;; æˆ–è€…ä»åŸèŠ‚ç‚¹æ‹‰å–æ›´æ–°
M-x org-roam-more-transclusion-pull
#+END_SRC

** å¯ç”¨æ—¥è®°é›†æˆ

#+BEGIN_SRC elisp
;; å¯ç”¨è‡ªåŠ¨æ—¥è®°æ’å…¥
(org-roam-more-toggle-insert-link-hook t)

;; ç¦ç”¨
(org-roam-more-toggle-insert-link-hook nil)
#+END_SRC

* æ¨¡å—ç»“æ„

åŒ…ç»„ç»‡ä¸ºä¸“æ³¨çš„æ¨¡å—ï¼š

- =org-roam-more-utils.el= - å·¥å…·å‡½æ•°ï¼ˆé“¾æ¥ã€è·¯å¾„ã€æ ‡é¢˜ï¼‰
- =org-roam-more-node.el= - èŠ‚ç‚¹å†…å®¹æ“ä½œ
- =org-roam-more-transclusion.el= - Transclusion ç®¡ç†
- =org-roam-more-capture.el= - èŠ‚ç‚¹åˆ›å»ºå’Œæ’å…¥
- =org-roam-more-daily.el= - æ—¥è®°é›†æˆ
- =org-roam-more.el= - ä¸»å…¥å£ç‚¹ï¼ˆåŠ è½½æ‰€æœ‰æ¨¡å—ï¼‰

* æ ¸å¿ƒå‡½æ•°

** Transclusion

| å‡½æ•° | æè¿° |
|------|------|
| =org-roam-more-insert-transclude= | åœ¨å…‰æ ‡å¤„æ’å…¥ transclusion |
| =org-roam-more-is-transclusion-p= | æ£€æŸ¥å½“å‰æ¡ç›®æ˜¯å¦ä¸º transclusion |
| =org-roam-more-transclusion-content-equal-p= | æ£€æŸ¥å†…å®¹æ˜¯å¦ä¸€è‡´ |
| =org-roam-more-transclusion-push= | æ™ºèƒ½æ¨é€ï¼ˆå½“å‰æˆ–å…¨éƒ¨ï¼‰ |
| =org-roam-more-transclusion-pull= | æ™ºèƒ½æ‹‰å–ï¼ˆå½“å‰æˆ–å…¨éƒ¨ï¼‰ |
| =org-roam-more-transclusion-push-current= | æ¨é€å½“å‰ transclusion |
| =org-roam-more-transclusion-push-all= | æ¨é€æ–‡ä»¶ä¸­æ‰€æœ‰ transclusion |
| =org-roam-more-transclusion-pull-current= | æ‹‰å–åˆ°å½“å‰ transclusion |
| =org-roam-more-transclusion-pull-all= | æ‹‰å–åˆ°æ‰€æœ‰ transclusion |
| =org-roam-more-compare-transclusion-and-roam-content= | ä½¿ç”¨ ediff å¯¹æ¯” |

** èŠ‚ç‚¹æ“ä½œ

| å‡½æ•° | æè¿° |
|------|------|
| =org-roam-more-get-node-content= | è·å–èŠ‚ç‚¹å†…å®¹ |
| =org-roam-more-set-node-content= | è®¾ç½®èŠ‚ç‚¹å†…å®¹ï¼ˆä¿ç•™æ ‡é¢˜/å±æ€§ï¼‰ |
| =org-roam-more-get-node-body= | äº¤äº’å¼è·å–èŠ‚ç‚¹æ­£æ–‡ |
| =org-roam-more-get-content-at-path= | æ ¹æ®å¤§çº²è·¯å¾„è·å–å†…å®¹ |
| =org-roam-more-set-content-at-path= | æ ¹æ®å¤§çº²è·¯å¾„è®¾ç½®å†…å®¹ |
| =org-roam-more-capture-under-node= | åœ¨ç°æœ‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ |
| =org-roam-more-set-source-property-from-node= | è®¾ç½® SOURCE å±æ€§ |

** èŠ‚ç‚¹åˆ›å»º

| å‡½æ•° | æè¿° |
|------|------|
| =org-roam-more-insert-new-node-with-id= | åˆ›å»º/é€‰æ‹©èŠ‚ç‚¹å¹¶æ’å…¥é“¾æ¥ |

** æ—¥è®°é›†æˆ

| å‡½æ•° | æè¿° |
|------|------|
| =org-roam-more-toggle-insert-link-hook= | å¯ç”¨/ç¦ç”¨è‡ªåŠ¨æ’å…¥ hook |
| =org-roam-more-insert-current-node-link-into-daily= | å°†å½“å‰èŠ‚ç‚¹æ’å…¥æ—¥è®° |

** å·¥å…·å‡½æ•°

| å‡½æ•° | æè¿° |
|------|------|
| =org-roam-more-node-link= | ç”ŸæˆèŠ‚ç‚¹é“¾æ¥ |
| =org-roam-more-format-link= | æ ¼å¼åŒ–èŠ‚ç‚¹é“¾æ¥ |
| =org-roam-more-insert-subheading= | æ’å…¥å­æ ‡é¢˜ |
| =org-roam-more-insert-heading-with-level= | æ’å…¥æŒ‡å®šå±‚çº§æ ‡é¢˜ |
| =org-roam-more-get-current-node-id-title= | è·å–å½“å‰èŠ‚ç‚¹ ID å’Œæ ‡é¢˜ |
| =org-roam-more-get-current-path= | è·å–å½“å‰å¤§çº²è·¯å¾„ |
| =org-roam-more-heading-to-olp= | æ ‡é¢˜è½¬å¤§çº²è·¯å¾„ |
| =org-roam-more-subheadings-under-olp= | è·å–è·¯å¾„ä¸‹çš„å­æ ‡é¢˜ |

* ä½¿ç”¨ç¤ºä¾‹

** Transclusion ç®¡ç†

#+BEGIN_SRC elisp
;; æ’å…¥ transclusion
(org-roam-more-insert-transclude)

;; æ£€æŸ¥å½“å‰æ¡ç›®æ˜¯å¦ä¸º transclusion
(org-roam-more-is-transclusion-p) ;; => t æˆ– nil

;; æ£€æŸ¥å†…å®¹æ˜¯å¦ä¸åŸèŠ‚ç‚¹åŒ¹é…
(org-roam-more-transclusion-content-equal-p) ;; => t æˆ– nil

;; æ™ºèƒ½æ¨é€ - è‡ªåŠ¨æ£€æµ‹ä¸Šä¸‹æ–‡
;; - å¦‚æœå…‰æ ‡åœ¨ transclusion æ¡ç›®å†…ï¼šæ¨é€å½“å‰æ¡ç›®
;; - å¦åˆ™ï¼šæ¨é€æ–‡ä»¶ä¸­æ‰€æœ‰ transclusion
(org-roam-more-transclusion-push)

;; æ™ºèƒ½æ‹‰å– - è‡ªåŠ¨æ£€æµ‹ä¸Šä¸‹æ–‡
;; - å¦‚æœå…‰æ ‡åœ¨ transclusion æ¡ç›®å†…ï¼šæ‹‰å–åˆ°å½“å‰æ¡ç›®
;; - å¦åˆ™ï¼šæ‹‰å–åˆ°æ‰€æœ‰ transclusion
(org-roam-more-transclusion-pull)

;; æ‰‹åŠ¨æ§åˆ¶
(org-roam-more-transclusion-push-current) ;; æ¨é€å½“å‰æ¡ç›®
(org-roam-more-transclusion-push-all)     ;; æ¨é€æ‰€æœ‰æ¡ç›®
(org-roam-more-transclusion-pull-current) ;; æ‹‰å–åˆ°å½“å‰
(org-roam-more-transclusion-pull-all)     ;; æ‹‰å–åˆ°å…¨éƒ¨

;; ä½¿ç”¨ ediff å¯¹æ¯”å¹¶æ›´æ–°ä¸¤ä¾§
(org-roam-more-compare-transclusion-and-roam-content)
#+END_SRC

** èŠ‚ç‚¹å†…å®¹æ“ä½œ

#+BEGIN_SRC elisp
;; è·å–èŠ‚ç‚¹å†…å®¹
(let* ((node (org-roam-node-read))
       (content (org-roam-more-get-node-content node t))) ;; t = ç§»é™¤å±æ€§
  (message "å†…å®¹: %s" content))

;; è®¾ç½®èŠ‚ç‚¹å†…å®¹ï¼ˆä¿ç•™æ ‡é¢˜å’Œå±æ€§ï¼‰
(let ((node (org-roam-node-read))
      (new-content "è¿™æ˜¯æ–°å†…å®¹ã€‚"))
  (org-roam-more-set-node-content node new-content))

;; æ ¹æ®è·¯å¾„è·å–å†…å®¹
(let ((path '("é¡¶å±‚" "ç¬¬äºŒå±‚" "ç›®æ ‡æ ‡é¢˜")))
  (org-roam-more-get-content-at-path path t)) ;; => å†…å®¹å­—ç¬¦ä¸²

;; æ ¹æ®è·¯å¾„è®¾ç½®å†…å®¹
(let ((path '("é¡¶å±‚" "ç¬¬äºŒå±‚" "ç›®æ ‡æ ‡é¢˜"))
      (new-content "æ›´æ–°çš„å†…å®¹ã€‚"))
  (org-roam-more-set-content-at-path path new-content))
#+END_SRC

** åˆ›å»ºèŠ‚ç‚¹

#+BEGIN_SRC elisp
;; åœ¨ç°æœ‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹
(org-roam-more-capture-under-node)

;; æ’å…¥æ–°èŠ‚ç‚¹å¹¶è‡ªåŠ¨åˆ›å»ºé“¾æ¥
(org-roam-more-insert-new-node-with-id)

;; æ’å…¥æ–°èŠ‚ç‚¹ä½œä¸º transclusion
(org-roam-more-insert-new-node-with-id nil nil t)
#+END_SRC

** æ—¥è®°é›†æˆ

#+BEGIN_SRC elisp
;; å¯ç”¨è‡ªåŠ¨æ’å…¥åˆ°æ—¥è®°
(org-roam-more-toggle-insert-link-hook t)

;; æ‰‹åŠ¨å°†å½“å‰èŠ‚ç‚¹æ’å…¥æ—¥è®°
(org-roam-more-insert-current-node-link-into-daily)

;; ç¦ç”¨è‡ªåŠ¨æ’å…¥
(org-roam-more-toggle-insert-link-hook nil)
#+END_SRC

* é…ç½®

** è‡ªå®šä¹‰ Transclusion è¡Œä¸º

#+BEGIN_SRC elisp
;; æ’å…¥å®Œæ•´å†…å®¹è€Œä¸æ˜¯ #+transclude é“¾æ¥ï¼ˆä¸æ¨èï¼‰
(setq org-roam-more-transclusion-insert-content nil)
#+END_SRC

** é”®ç»‘å®šç¤ºä¾‹

#+BEGIN_SRC elisp
(with-eval-after-load 'org-roam-more
  (define-key org-mode-map (kbd "C-c n t i") #'org-roam-more-insert-transclude)
  (define-key org-mode-map (kbd "C-c n t p") #'org-roam-more-transclusion-push)
  (define-key org-mode-map (kbd "C-c n t u") #'org-roam-more-transclusion-pull)
  (define-key org-mode-map (kbd "C-c n t c") #'org-roam-more-compare-transclusion-and-roam-content)
  (define-key org-mode-map (kbd "C-c n c") #'org-roam-more-capture-under-node))
#+END_SRC

* Transclusion å·¥ä½œåŸç†

1. *æ’å…¥*ï¼šå½“ä½ æ’å…¥ transclusion æ—¶ï¼ŒæºèŠ‚ç‚¹çš„å®Œæ•´å†…å®¹ï¼ˆåŒ…æ‹¬å…¶æ ‡é¢˜ç»“æ„ï¼‰ä¼šè¢«å¤åˆ¶åˆ°å½“å‰ä½ç½®ã€‚

2. *æ ‡è®°*ï¼šè½¬å†™çš„å†…å®¹ä¼šè¢«æ ‡è®°ï¼š
   - é¡¶å±‚æ ‡é¢˜ä¸Šæœ‰ =:transclusion:= æ ‡ç­¾
   - å±æ€§ï¼š=ORIGINAL-ID=ã€=ORIGINAL-HEADING=ã€=ORIGINAL-NODE-LINK=

3. *åŒæ­¥*ï¼š
   - *Pushï¼ˆæ¨é€ï¼‰*ï¼šä» transclusion å¤åˆ¶å†…å®¹åˆ°åŸèŠ‚ç‚¹
   - *Pullï¼ˆæ‹‰å–ï¼‰*ï¼šä»åŸèŠ‚ç‚¹å¤åˆ¶å†…å®¹åˆ° transclusion
   - å†…å®¹æ¯”è¾ƒæ—¶å¿½ç•¥é¦–å°¾ç©ºç™½

4. *æ™ºèƒ½æ£€æµ‹*ï¼šPush/pull å‘½ä»¤è‡ªåŠ¨æ£€æµ‹ä½ æ˜¯å¦åœ¨ transclusion æ¡ç›®å†…ï¼Œå¹¶ç›¸åº”åœ°æ‰§è¡Œæ“ä½œã€‚

* å·¥ä½œæµæ¨è

** åœºæ™¯ 1ï¼šä½¿ç”¨ Transclusion

1. æ’å…¥ transclusionï¼š=M-x org-roam-more-insert-transclude=
2. å°±åœ°ç¼–è¾‘å†…å®¹
3. æ¨é€æ›´æ”¹ï¼š=M-x org-roam-more-transclusion-push=
4. å¦‚æœåŸèŠ‚ç‚¹æœ‰æ›´æ”¹ï¼š=M-x org-roam-more-transclusion-pull=

** åœºæ™¯ 2ï¼šåˆ›å»ºå…³è”ç¬”è®°

1. æ­£å¸¸åˆ›å»ºçˆ¶ç¬”è®°
2. ä½¿ç”¨ =M-x org-roam-more-capture-under-node= åˆ›å»ºå­ç¬”è®°
3. å¯é€‰ï¼šå°†å­ç¬”è®° transclude åˆ°çˆ¶ç¬”è®°ä¸­ä»¥è·å¾—æ¦‚è§ˆ

** åœºæ™¯ 3ï¼šæ¯æ—¥æ—¥è®°

1. å¯ç”¨ hookï¼š=(org-roam-more-toggle-insert-link-hook t)=
2. æ­£å¸¸åˆ›å»ºç¬”è®°
3. é“¾æ¥è‡ªåŠ¨å‡ºç°åœ¨ä½ çš„æ—¥è®°ä¸­

* æ•…éšœæ’é™¤

** Transclusion æœªè¢«æ£€æµ‹åˆ°

- ç¡®ä¿æ ‡é¢˜æœ‰ =:transclusion:= æ ‡ç­¾
- æ£€æŸ¥ =ORIGINAL-ID= å±æ€§æ˜¯å¦å­˜åœ¨

** å†…å®¹æœªåŒæ­¥

- ä½¿ç”¨ =org-roam-more-transclusion-content-equal-p= æ£€æŸ¥æ˜¯å¦ç›¸ç­‰
- å°è¯• =org-roam-more-compare-transclusion-and-roam-content= æŸ¥çœ‹å·®å¼‚

** æ—¥è®°æ’å…¥ä¸å·¥ä½œ

- éªŒè¯ hook å·²å¯ç”¨ï¼š=org-roam-more-insert-link-hook-enabled= åº”ä¸º =t=
- æ£€æŸ¥ =~/org/roam/daily/journal.org= æ˜¯å¦å­˜åœ¨ï¼ˆæˆ–è‡ªå®šä¹‰è·¯å¾„ï¼‰

* è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·ï¼š

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. è¿›è¡Œæ›´æ”¹
4. æäº¤ pull request

* è®¸å¯è¯

GPL-3.0-or-later

* è‡´è°¢

- [[https://www.orgroam.com/][org-roam]] - æœ¬åŒ…æ„å»ºçš„åŸºç¡€
- Emacs å’Œ Org-mode ç¤¾åŒº

